@BASE = http://localhost:8080

@JWT = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJjbWltcWpnbzUwMDAwbmdyd2F5dWw4YWF0IiwibG9naW5JZCI6ImFobm5ldSIsInR5cGUiOiJhY2Nlc3MiLCJqdGkiOiJjMzYxN2NmZi0xZTQ2LTRhNTctODc0My04NzNkZWJkYTgzNjkiLCJpYXQiOjE3NjQ1NzA2NzQsImV4cCI6MTc2NDU3MTU3NH0.m1DBAQtxIoX-JSX4AZjE_9vSd-madUUeXFA5RDXU6O0

### 회원가입

POST http://localhost:8080/api/auth/signup
Content-Type: application/json

{
  "loginId": "ahnneu",
  "password": "tkddk128!",
  "name": "안상아",
  "gender": "F",
  "phone": "010-3630-4640",
  "birthDate": "2004-12-28",
  "smsConsent": true,
  "termsConsent": true
}

### 로그인

POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "loginId": "ahnneu",
  "password": "tkddk128!"
}

### 방(ROOM) 도메인 테스트 (로컬 서버 기준)

### 1. 방 생성 (로컬)
### - JWT는 위에서 로그인 해서 직접 복사해 넣기 (@JWT 갱신 필수!)

POST {{BASE}}/api/rooms
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "title": "ㅇㅅㅇ22",
  "departureLabel": "전북대 구정문",
  "departureLat": 35.846100,
  "departureLng": 127.129100,
  "arrivalLabel": "전주 시외버스터미널",
  "arrivalLat": 35.825000,
  "arrivalLng": 127.148000,
  "departureTime": "2025-11-20T15:30:00.000Z",
  "capacity": 4,
  "priority": "time",
  "estimatedFare": 12000
}

### 방 생성 후, 응답 JSON에서 "id" 값을 복사해서
@ROOM_ID = cmimqvfhm0003ngeq0na2jdi1

### 2. 방 목록 조회 (전체)
GET {{BASE}}/api/rooms
Authorization: Bearer {{JWT}}

### 2-1. 내가 만든/참여한 방 목록 조회 (mine=true)
GET {{BASE}}/api/rooms?mine=true
Authorization: Bearer {{JWT}}

### 2-2. 특정 방 상세 정보 확인 (참여자/정산 상태 체크)
GET {{BASE}}/api/rooms/{{ROOM_ID}}
Authorization: Bearer {{JWT}}

### --- 시나리오 테스트 템플릿 ---
### 공통 변수는 필요 시 아래처럼 추가해서 사용
# @SETTLEMENT_ROOM_ID = {{ROOM_ID}}
@PAYMENT_SESSION_ID = 2d2fa18b-2eef-45e6-8dd6-710314e75d03

### 3. 지갑 잔액 조회
GET {{BASE}}/api/wallet/balance
Authorization: Bearer {{JWT}}

### 4. 지갑 충전 (Top-up)
POST {{BASE}}/api/wallet/topup
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "roomId": "{{ROOM_ID}}",
  "amount": 10000,
  "idempotencyKey": "topup-{{ROOM_ID}}-{{$timestamp}}"
}

### 5. 지갑 차감/환불 (Charge)
POST {{BASE}}/api/wallet/charge
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "roomId": "{{ROOM_ID}}",
  "kind": "hold_deposit",
  "amount": 5000,
  "allowNegative": false,
  "idempotencyKey": "charge-{{ROOM_ID}}-{{$timestamp}}",
  "metadata": {
    "note": "scenario test"
  }
}

### 6. 결제 세션 생성 (Mock PG)
POST {{BASE}}/api/payments/mock/session
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "amount": 15000,
  "currency": "KRW",
  "purpose": "wallet_topup",
  "roomId": "{{ROOM_ID}}",
  "metadata": {
    "memo": "wallet scenario"
  }
}

### 7. 결제 세션 성공 처리 (sessionId를 응답에서 복사)
POST {{BASE}}/api/payments/mock/session/{{PAYMENT_SESSION_ID}}/confirm
Authorization: Bearer {{JWT}}

### 8. 결제 세션 실패 처리 (테스트용)
POST {{BASE}}/api/payments/mock/session/{{PAYMENT_SESSION_ID}}/fail
Authorization: Bearer {{JWT}}

### 9. 결제 세션 목록 확인
GET {{BASE}}/api/payments/mock/sessions
Authorization: Bearer {{JWT}}

### 10. 정산 - 예치금 홀드
POST {{BASE}}/api/settlements/rooms/{{ROOM_ID}}/hold
Authorization: Bearer {{JWT}}

### 11. 정산 - 최종 정산
POST {{BASE}}/api/settlements/rooms/{{ROOM_ID}}/finalize
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "actualFare": 13000
}

### 12. 알림 목록 (메모리 저장된 알림 확인)
GET {{BASE}}/api/notifications
Authorization: Bearer {{JWT}}

### 13. 알림 발송 테스트
POST {{BASE}}/api/notifications/test
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "title": "시나리오 테스트",
  "body": "결제/정산 후 알림 확인"
}

### 14. 후기 작성
POST {{BASE}}/api/reviews
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "roomId": "{{ROOM_ID}}",
  "rating": 5,
  "comment": "매우 만족한 택시 동승 경험"
}

### 15. 방 후기 목록 조회
GET {{BASE}}/api/reviews/room/{{ROOM_ID}}
Authorization: Bearer {{JWT}}

### 16. 내 후기 목록
GET {{BASE}}/api/reviews/me
Authorization: Bearer {{JWT}}

### 17. 신고 작성
POST {{BASE}}/api/reports
Authorization: Bearer {{JWT}}
Content-Type: application/json

{
  "roomId": "{{ROOM_ID}}",
  "reportedSeatNumber": 2,
  "message": "지각으로 인한 신고 테스트"
}

### 18. 방 신고 목록 조회
GET {{BASE}}/api/reports/room/{{ROOM_ID}}
Authorization: Bearer {{JWT}}

### 19. 내 신고 목록
GET {{BASE}}/api/reports/me
Authorization: Bearer {{JWT}}

### 20. 내 이용 기록 (마이페이지)
GET {{BASE}}/api/rides/history
Authorization: Bearer {{JWT}}

### 21. 이용 기록 + 후기 확인 셀프 시나리오
# 1) 위 10~11(hold/finalize) 호출 후
# 2) 후기 작성(14)까지 완료하고
# 3) 아래 요청을 다시 보내면 histories 배열에 방 정보 + 후기 여부가 나타납니다.
GET {{BASE}}/api/rides/history
Authorization: Bearer {{JWT}}
